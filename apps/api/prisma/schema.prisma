// path: apps/api/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String   @id @default(cuid())
  email            String   @unique
  username         String   @unique
  phone            String?
  password         String?
  name             String?
  role             Role     @default(CUSTOMER)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  stripeCustomerId String?  @unique
  googleId         String?  @unique
  orders           Order[]
  subscription     Subscription?
}

model Subscription {
  id                   String   @id @default(cuid())
  stripeSubscriptionId String   @unique
  planId               String
  status               String
  currentPeriodEnd     DateTime
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  user                 User     @relation(fields: [userId], references: [id])
  userId               String   @unique
}

model Template {
  id                     String  @id @default(cuid())
  name                   String
  description            String
  previewImgUrl          String
  designHuddleTemplateId String  @unique
  isActive               Boolean @default(true)

  orders                 Order[]
}

model Order {
  id                  String      @id @default(cuid())
  status              OrderStatus @default(PENDING)
  type                OrderType
  contentJson         String?
  finalPdfUrl         String?
  paymentId           String?
  amountPaid          Float
  shippingAddressJson String?
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt

  user                User        @relation(fields: [userId], references: [id])
  userId              String
  template            Template?   @relation(fields: [templateId], references: [id])
  templateId          String?
}

// CORRECTED ENUM SYNTAX BELOW
enum Role {
  CUSTOMER
  DESIGNER
  ADMIN
}

enum OrderType {
  DIY
  PREMIUM
}

enum OrderStatus {
  PENDING
  PAID
  IN_DESIGN
  AWAITING_APPROVAL
  PRINTING
  SHIPPED
  DELIVERED
  CANCELED
}